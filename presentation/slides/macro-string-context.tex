\begin{frame}[fragile]{Parsing string contexts}

  \begin{block}{}
    String contexts are syntactic sugars that support splicing (= injection of parameters):
  \end{block}

\begin{scalacode}[\footnotesize]
extension (inline sc: StringContext)
  inline def url(inline args: Any*): URL =
    ${ urlImpl('sc, 'args) }

def urlImpl(scExpr: Expr[StringContext], argsExpr: Expr[Seq[Any]])(using Quotes): Expr[URL] =
  val rawUrl = scExpr.valueOrAbort.parts.mkString
  Try(URL(rawUrl)) match
    case Success(_) => '{ URL(${ Expr(rawUrl) }) }
    case Failure(_) => quotes.reflect.report
      .errorAndAbort(s"Invalid URL: '$rawUrl'")
\end{scalacode}

\begin{scalacode}[\footnotesize]
url"http://example.com"
url"not_a_url" // Compilation error
\end{scalacode}

\end{frame}